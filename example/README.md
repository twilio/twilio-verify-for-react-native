# Twilio Verify React Native - Example App

A modern, production-ready example application demonstrating how to use Twilio Verify Push in React Native.

## Table of Contents

- [Features](#features)
- [Quick Start](#quick-start)
- [Installation](#installation)
- [Configuration](#configuration)
- [Usage Guide](#usage-guide)
- [API Reference](#api-reference)
- [Code Examples](#code-examples)
- [Project Structure](#project-structure)
- [Troubleshooting](#troubleshooting)
- [Learn More](#learn-more)

## Features

- ‚úÖ **Factor Management**: Create, list, and delete verification factors
- ‚úÖ **Push Challenges**: Handle and respond to push authentication challenges
- ‚úÖ **Modern UI**: Built with React Native Reanimated for smooth animations
- ‚úÖ **Network Monitoring**: Real-time network connectivity status
- ‚úÖ **Developer Tools**: Built-in utilities for testing and debugging
- ‚úÖ **Type Safety**: Full TypeScript support

---

## Quick Start

Get started in under 10 minutes:

### 1. Install Dependencies

```bash
cd example
yarn install

# iOS only
cd ios && pod install && cd ..
```

### 2. Setup Backend Server

Create a token server that generates Twilio access tokens:

```javascript
const express = require('express');
const twilio = require('twilio');

const app = express();
app.use(express.json());

const client = twilio(
  process.env.TWILIO_ACCOUNT_SID,
  process.env.TWILIO_AUTH_TOKEN
);
const serviceSid = process.env.TWILIO_VERIFY_SERVICE_SID;

app.post('/token', async (req, res) => {
  try {
    const { identity } = req.body;
    const token = await client.verify.v2
      .services(serviceSid)
      .accessTokens
      .create({ identity });

    res.json({
      token: token.token,
      serviceSid: serviceSid,
      identity: identity
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000);
```

### 3. Run the App

```bash
# iOS
yarn ios

# Android
yarn android
```

### 4. Create Your First Factor

1. Open the app ‚Üí **Create Factor** screen
2. Click üé≤ to generate a random test identity
3. Enter your token server URL: `http://localhost:3000/token`
4. Tap **Create Factor**
5. Success! The factor is now registered

---

## Installation

### Prerequisites

Before you begin, ensure you have:

1. **Node.js** >= 18
2. **React Native development environment** set up ([Setup Guide](https://reactnative.dev/docs/environment-setup))
3. **Twilio Account** with Verify service configured
4. **Access Token Server** (see Quick Start section)

### Install Dependencies

```bash
cd example
yarn install
```

### iOS Setup

```bash
cd ios && pod install && cd ..
```

### Android Setup

No additional steps required after `yarn install`.

---

## Configuration

### Backend Server Requirements

Your backend must return a JSON response with:

```json
{
  "token": "eyJhbGc...",           // or "accessToken"
  "serviceSid": "VAxxxxx...",      // Twilio Verify Service SID (starts with VA)
  "identity": "user@example.com"   // User's unique identifier
}
```

### Important Notes

- **serviceSid** must start with `VA` (Verify Service SID)
- Don't use your Account SID here
- The access token is a JWT generated by Twilio's API

---

## Usage Guide

### Creating a Factor

A factor represents a registered device for 2FA:

1. Navigate to **Create Factor** screen
2. Enter user identity (or use üé≤ to generate random)
3. Enter your access token URL
4. Tap **Create Factor**

**What happens:**
- App requests access token from your backend
- Creates factor with Twilio Verify
- Verifies the factor automatically
- Device is now registered for push challenges

**Code location:** `src/views/CreateFactor.tsx:80`

### Viewing Factors

Navigate to **Factors** screen to see all registered factors:

- Pull to refresh the list
- Tap a factor to view details and challenges
- Swipe left to delete a factor

**Code location:** `src/views/Factors.tsx:68`

### Handling Challenges

When a verification challenge is sent:

1. Device receives push notification
2. Tap notification to open Challenge screen
3. Review challenge details
4. Tap **Approve** or **Deny**
5. Response sent to Twilio

**Code location:** `src/views/Challenge.tsx:71`

---

## API Reference

### Factor Management

#### `createFactor(payload)`

Creates a new verification factor and registers the device.

**Parameters:**
```typescript
{
  friendlyName: string;      // Display name
  serviceSid: string;        // Verify Service SID (starts with 'VA')
  identity: string;          // User's unique identifier
  accessToken: string;       // JWT from your backend
  factorType: FactorType;    // FactorType.Push
  pushToken?: string;        // Optional: device push token
}
```

**Returns:** `Promise<Factor>`

**Example:**
```typescript
const factor = await TwilioVerify.createFactor({
  friendlyName: "John's iPhone",
  serviceSid: "VAxxxxxxxxxxxxx",
  identity: "john@example.com",
  accessToken: "eyJhbGc...",
  factorType: FactorType.Push,
});
```

**Code:** `src/views/CreateFactor.tsx:136`

---

#### `verifyFactor(payload)`

Verifies a newly created factor. Must be called after `createFactor()`.

**Parameters:**
```typescript
{
  sid: string;              // Factor SID from createFactor()
  factorType: FactorType;   // FactorType.Push
}
```

**Returns:** `Promise<Factor>`

**Code:** `src/views/CreateFactor.tsx:145`

---

#### `getAllFactors()`

Retrieves all factors stored on the device.

**Returns:** `Promise<Factor[]>`

**Example:**
```typescript
const factors = await TwilioVerify.getAllFactors();
```

**Code:** `src/views/Factors.tsx:70`

---

#### `deleteFactor(sid)`

Deletes a factor from local storage and Twilio Verify service.

**Parameters:**
- `sid: string` - The factor's unique identifier

**Returns:** `Promise<void>`

**Code:** `src/views/Factors.tsx:117`

---

### Challenge Management

#### `getAllChallenges(options)`

Retrieves challenges for a specific factor.

**Parameters:**
```typescript
{
  factorSid: string;           // The factor's SID
  pageSize: number;            // Max 20
  pageToken?: string;          // For pagination
  order: ChallengeListOrder;   // 'asc' or 'desc'
}
```

**Returns:** `Promise<ChallengeList>`

**Code:** `src/views/Factor.tsx:57`

---

#### `getChallenge(challengeSid, factorSid)`

Retrieves a specific challenge by its SID.

**Parameters:**
- `challengeSid: string`
- `factorSid: string`

**Returns:** `Promise<Challenge>`

**Code:** `src/views/Challenge.tsx:37`

---

#### `updateChallenge(payload)`

Approves or denies a challenge.

**Parameters:**
```typescript
{
  factorSid: string;
  challengeSid: string;
  status: ChallengeStatus;    // 'approved' or 'denied'
  factorType: FactorType;
}
```

**Returns:** `Promise<void>`

**Code:** `src/views/Challenge.tsx:80`

---

### Utility Methods

#### `isAvailable()`

Checks if the SDK is properly initialized.

**Returns:** `Promise<boolean>`

**Code:** `src/views/CreateFactor.tsx:171`

---

#### `clearLocalStorage()`

‚ö†Ô∏è **Warning: Destructive!** Removes all factors from local storage.

**Returns:** `Promise<void>`

**Code:** `src/views/CreateFactor.tsx:182`

---

## Code Examples

### Complete Factor Creation Flow

```typescript
// 1. Get access token from your server
const response = await fetch('https://your-server.com/token', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ identity: 'user@example.com' })
});
const { token, serviceSid, identity } = await response.json();

// 2. Create the factor
let factor = await TwilioVerify.createFactor({
  friendlyName: "User's Phone",
  serviceSid: serviceSid,
  identity: identity,
  accessToken: token,
  factorType: FactorType.Push,
});

// 3. Verify the factor
factor = await TwilioVerify.verifyFactor({
  sid: factor.sid,
  factorType: FactorType.Push,
});
```

### Handle Push Challenge

```typescript
// 1. Get the challenge (from push notification)
const challenge = await TwilioVerify.getChallenge(
  challengeSid,
  factorSid
);

// 2. Show to user, then approve/deny
await TwilioVerify.updateChallenge({
  factorSid: factorSid,
  challengeSid: challengeSid,
  status: 'approved', // or 'denied'
  factorType: FactorType.Push,
});
```

### Error Handling

```typescript
try {
  const factor = await TwilioVerify.createFactor(payload);
} catch (error) {
  console.error('Failed to create factor:', error);
  // Handle error appropriately
}
```

---

## Project Structure

```
example/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Reusable UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Challenge.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChallengeListItem.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChallengeRequest.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Factor.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FactorListItem.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NetworkIndicator.tsx
‚îÇ   ‚îú‚îÄ‚îÄ constants/           # Design system tokens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Colors.ts
‚îÇ   ‚îú‚îÄ‚îÄ push/                # Push notification handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationHandler.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationService.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/               # TypeScript types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Navigation.ts
‚îÇ   ‚îú‚îÄ‚îÄ views/               # Screen components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Challenge.tsx    # Challenge detail screen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateFactor.tsx # Factor creation form
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Factor.tsx       # Factor detail + challenges
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Factors.tsx      # Factors list
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx              # Navigation setup
```

---

## Troubleshooting

### "Network request failed"
This is the most common error when testing. The app cannot connect to your backend server.

**Android Emulator:**
- ‚ùå Don't use `localhost` or `127.0.0.1` (these point to the emulator itself)
- ‚úÖ Use `10.0.2.2` instead
- Example: `http://10.0.2.2:3000/token`

**iOS Simulator:**
- ‚úÖ Use `localhost` or your machine's IP address
- Example: `http://localhost:3000/token`
- Or: `http://192.168.1.x:3000/token`

**Real Device:**
- Use your machine's IP address on the same network
- Example: `http://192.168.1.x:3000/token`
- Make sure firewall allows incoming connections

**Verify your server is running:**
```bash
# Test in terminal
curl -X POST http://localhost:3000/token \
  -H "Content-Type: application/json" \
  -d '{"identity":"test@example.com"}'
```

### "Access token not found in response"
- Ensure your server returns `token` or `accessToken`
- Check console logs for full server response
- Verify JSON format matches expected structure

### "Invalid serviceSid format"
- ServiceSid must start with `VA`
- Don't use your Account SID
- Get the correct SID from Twilio Console

### Push notifications not working
- Test on a real device (simulators don't support push)
- Verify APNs (iOS) or FCM (Android) configuration
- Check device token is registered with Twilio
- Review push notification setup in Twilio Console

### "TwilioVerify is not available"
- Ensure SDK is properly linked
- Try `pod install` (iOS) or clean build (Android)
- Check all native dependencies are installed
- Use **Developer Tools** ‚Üí **Check Availability** in the app

### Network errors
- Check the **Network Indicator** at top of screens
- Verify backend server is running and accessible
- Test server URL in browser/Postman first

---

## Learn More

- [Twilio Verify Documentation](https://www.twilio.com/docs/verify)
- [Twilio Verify Push Setup](https://www.twilio.com/docs/verify/push)
- [React Native Documentation](https://reactnative.dev/)
- [React Native Reanimated](https://docs.swmansion.com/react-native-reanimated/)

## Support

For issues or questions:
- Check the [main project README](../README.md)
- Open an issue on [GitHub](https://github.com/twilio/twilio-verify-for-react-native/issues)
- Visit [Twilio Support](https://support.twilio.com/)

---

## License

This example app is licensed under the Apache License 2.0. See the main project LICENSE file for details.
